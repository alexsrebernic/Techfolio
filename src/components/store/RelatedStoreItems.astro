---
import { APP_STORE, I18N } from "@/utils/config";

import { fetchStoreItems, getRelatedStoreItems } from "@/utils/store";
import BlogHighlightedPosts from "../widgets/BlogHighlightedPosts.astro";
import type NormalizedStoreItem from '@/interfaces/NormalizedStoreItem'
import { getStorePermaLink } from "@/utils/permalinks";

export interface Props {
  storeItem: NormalizedStoreItem;
}

const { storeItem } = Astro.props;
const lang = I18N.language
const fetchedPosts = await fetchStoreItems(lang);
const relatedPosts = storeItem.tags ? getRelatedStoreItems(fetchedPosts, storeItem.slug, storeItem.tags) : [];
---

{
  APP_STORE.isRelatedPostsEnabled ? (
    <BlogHighlightedPosts
      classes={{ container: "pt-0 lg:pt-0 md:pt-0" }}
      title="Related Posts"
      linkText="View All Posts"
      linkUrl={getStorePermaLink()}
      postIds={relatedPosts.map((post) => post.id)}
    />
  ) : null
}
