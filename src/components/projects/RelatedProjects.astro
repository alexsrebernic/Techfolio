---
import { APP_PROJECTS } from "~/utils/config";

import { fetchNormalizedProjects, fetchProjects, getRelatedNormalizedProjects } from "~/utils/projects";
import BlogHighlightedPosts from "./BlogHighlightedPosts.astro";
import { getProjectsPermaLink } from "~/utils/permalinks";
import type { Project } from "~/types";
import { getLocaleFromUrl } from "~/i18n/translator";

export interface Props {
  post: Project;
}

const { post } = Astro.props;
const locale = getLocaleFromUrl(Astro.url)
const fetchedPosts = await fetchProjects(locale);
const relatedPosts = post.tags ? getRelatedNormalizedProjects(fetchedPosts, post.slug, post.tags) : [];
---

{
  APP_PROJECTS.isRelatedPostsEnabled ? (
    <BlogHighlightedPosts
      classes={{ container: "pt-0 lg:pt-0 md:pt-0" }}
      title="Related Posts"
      linkText="View All Posts"
      linkUrl={getProjectsPermaLink()}
      postIds={relatedPosts.map((post) => post.id)}
    />
  ) : null
}
